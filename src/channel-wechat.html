<!doctype html>
<html lang="en">
  <head>
    @@include("partials/head.html", {
    "pageTitle": "Landkit"
    })
  </head>
  <body class="bg-light">

    <!-- MODALS
    ================================================== -->
    @@include("partials/modals.html")

    <!-- NAVBAR
    ================================================== -->
    @@include("partials/navbar.html", {
    "classList": "navbar-light bg-white",
    "container": "container-md"
    })


    <!-- BREADCRUMB
    ================================================== -->
    <nav class="bg-dark d-md-none">
      <div class="container-md">
        <div class="row align-items-center">
          <div class="col">

            <!-- Breadcrumb -->
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <span class="text-white">
                  Account
                </span>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                <span class="text-white">
                  Security
                </span>
              </li>
            </ol>

          </div>
          <div class="col-auto">

            <!-- Toggler -->
            <div class="navbar-dark">
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenavCollapse" aria-controls="sidenavCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            </div>

          </div>
        </div> <!-- / .row -->
      </div> <!-- / .container -->
    </nav>

    <!-- HEADER
    ================================================== -->
    <header class="bg-dark pt-9 pb-11 d-none d-md-block">
      <div class="container-md">
        <div class="row align-items-center">
          <div class="col">

            <!-- Heading -->
            <h1 class="font-weight-bold text-white mb-2">
              Account Settings
            </h1>

          </div>
        </div> <!-- / .row -->
      </div> <!-- / .container -->
    </header>

    <!-- MAIN
    ================================================== -->
    <main class="pb-8 pb-md-11 mt-md-n6">
      <div class="container-md">
        <div class="row">
          <div class="col-12 col-md-3">

            <!-- Card -->
            <div class="card card-bleed border-bottom border-bottom-md-0 shadow-light-lg">

              <!-- Collapse -->
              <div class="collapse d-md-block" id="sidenavCollapse">
                <div class="card-body">

                  <!-- Heading -->
                  <h6 class="font-weight-bold text-uppercase mb-3">
                    Account
                  </h6>

                  <!-- List -->
                  <ul class="card-list list text-gray-700 mb-6">
                    <li class="list-item">
                      <a class="list-link text-reset" href="account-general.html">
                        General
                      </a>
                    </li>
                  </ul>

                  <!-- Heading -->
                  <h6 class="font-weight-bold text-uppercase mb-3">
                    通知方式
                  </h6>

                  <!-- List -->
                  <ul class="card-list list text-gray-700 mb-0">
                    <!-- <li class="list-item">
                      <a class="list-link text-reset" href="billing-plans-and-payment.html">
                        Email
                      </a>
                    </li> -->
                    <li class="list-item active">
                      <a class="list-link text-reset" href="channel-wechat.html">
                        WeChat
                      </a>
                    </li>
                  </ul>

                </div>
              </div>

            </div>

          </div>
          <div class="col-12 col-md-9">

            <!-- Card -->
            <div class="card card-bleed shadow-light-lg mb-6">
              <div class="card-header">
                <div class="row align-items-center">
                  <div class="col">

                    <!-- Heading -->
                    <h4 class="mb-0">
                      1. 绑定微信账号
                    </h4>

                  </div>
                </div>
              </div>
              <div class="card-body">

                <!-- List group -->
                <div class="list-group list-group-flush">
                  <div class="list-group-item">
                    <div class="row align-items-center">
                      <div class="col">
                        <img id="bytecare-wechat-qr" width="30%" src="" />
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>


          <!-- ALERT
          ================================================== -->
          <div id="bytecare-set-channel-wechat-alert" class="alert alert-danger rounded-0 mb-0" style="display: none;">
                  <!-- Text -->
                  <p class="text-center mb-0">
                    Please scan QR Code first to bind your WeChat.
                  </p>
          </div>

            <!-- Card -->
            <div class="card card-bleed shadow-light-lg">
              <div class="card-header">
                <div class="row align-items-center">
                  <div class="col">

                    <!-- Heading -->
                    <h4 class="mb-0">
                      2. 设置微信为默认通知方式
                    </h4>

                  </div>
                  <div class="col-auto">

                    <!-- Button -->
                    <button id="bytecare-set-channel-wechat" class="btn btn-sm btn-primary">
                      <span id="bytecare-set-channel-wechat-succeed" style="display: none;">✔</span>
                      <span id="bytecare-set-channel-wechat-fail" style="display: none;">❌</span>
                      <span id="bytecare-set-channel-wechat-loading" class="spinner-border spinner-border-sm" style="display: none;" role="status" aria-hidden="true"></span>
                      确认
                    </button>
        
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div> <!-- / .row -->
      </div> <!-- / .container -->
    </main>

    <!-- CURVE
    ================================================== -->
    <div class="position-relative">
      <div class="shape shape-bottom shape-fluid-x svg-shim text-dark">
        @@include("assets/img/shapes/curves/curve-1.svg")
      </div>
    </div>

    <!-- FOOTER
    ================================================== -->
    @@include("partials/footer.html", {
    "classList": "bg-dark"
    })

    <script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.20.0/axios.min.js"></script>
    
    <!-- JAVASCRIPT
    ================================================== -->
    @@include("partials/scripts.html")
    <script>
      console.log(233);

      new ClipboardJS('.bytecare-copy');

      const token = Cookies.get('token');
      const headers = {
        'X-Token': token
      }

      // const axios = require('axios');
      const instance = axios.create({
        baseURL: 'https://api.bytecare.xyz/',
        timeout: 1000,
        headers
      })

      instance.request('/view-key', {
        method: 'POST',
      }).then(function (response) {
        $("#bytecare-ak").text(response.data.AccessKey);
        $("#bytecare-sk").text(response.data.SecretKey);
      }).catch(function (error) {
        console.log(error);
      })

      instance.request('/wechat-qr', {
        method: 'POST',
      }).then(function (response) {
        $("#bytecare-wechat-qr").attr('src',`https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=${response.data}`);
        console.log(response.data);
      }).catch(function (error) {
        console.log(error);
      })

      $( "#bytecare-set-channel-wechat" ).click(function() {
        $("#bytecare-set-channel-wechat-loading").show();

        instance.request('/set-default-channel??channel=1', {
          method: 'POST',
        }).then(function (response) {
          console.log(response);
          $("#bytecare-set-channel-wechat-loading").hide();
          $("#bytecare-set-channel-wechat").removeClass("btn-primary");
          $("#bytecare-set-channel-wechat").addClass("btn-success");
          $("#bytecare-set-channel-wechat-succeed").show();
        }).catch(function (error) {
          $("#bytecare-set-channel-wechat-loading").hide();
          $("#bytecare-set-channel-wechat").removeClass("btn-primary");
          $("#bytecare-set-channel-wechat").addClass("btn-danger");
          $("#bytecare-set-channel-wechat-fail").show();
          $("#bytecare-set-channel-wechat-alert").show();
          console.log(error);
        })


      });
      // $(document).ready(function(){
      //     $("#bytecare-ak").text("Hello");
      // });
    </script>

  </body>
</html>
